# 差分マージ仕様（v1.3）

## 1) 単位
- シーン → セクション（推奨ラベル）→ 行ブロック。
- ラベル例: `[主語][動作][場所/時間][カメラ/レンズ][尺][備考]`。

## 2) アルゴリズム
- 3-way merge: Base（採用テキストの前版）/ Ours（Manual）/ Theirs（AI）。
- 差分検出: LCS ベース（語またはサブワード）。
- 類似度スコア（Cosine or Jaccard）で自動マージ/衝突を決定（閾値=0.75 既定）。

## 3) ルール
- `Scene.lock='manual'`: Manual 優先。AI は提案扱い。低スコアは衝突。
- `Scene.lock='ai'` : AI 優先。ただし低スコアは衝突。
- 衝突書式:
```
<<<<<<< MANUAL
...manual...
=======
...ai...
>>>>>>> AI
```

## 4) UI
- 差分プレビュー：自動採用=薄緑、衝突=黄色。
- 衝突解消UI：Manual採用 / AI採用 / 手動編集。
- 信頼度メーター（0–1）。

## 5) 証跡
- `runs/<ts>/merge.json` に決定・スコア・衝突数・閾値等を記録。
- `meta.json` に `merge_profile` を追記。

## 6) 受入基準
- ラベルありで自動マージ率 ≥ 80%。
- 衝突はUIで全解消可。
- 同一入力なら決定的結果（再実行で変化しない）。
